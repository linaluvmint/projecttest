<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Buat Update Baru</title>
<style>
  body{margin:0;padding:20px;font-family:'Segoe UI',Tahoma,sans-serif;background:linear-gradient(to bottom right,#c8e6c9,#e8f5e9);min-height:100vh;display:flex;justify-content:center;}
  .container{background:#fff;max-width:650px;width:100%;border-radius:20px;padding:30px;box-shadow:0 20px 40px rgba(56,142,60,.35);position:relative;}
  h1{text-align:center;}
  label{font-weight:700;display:block;margin:10px 0 5px;}
  input,textarea{width:100%;padding:12px;border:2px solid #a5d6a7;border-radius:14px;margin-bottom:15px;}
  textarea{min-height:140px;}
  input[type=color]{width:70px;height:40px;border:none;}
  button{background:#1b5e20;color:#fff;font-weight:700;border:none;padding:14px 28px;border-radius:16px;cursor:pointer;display:block;margin:auto;}
  #back-button{position:absolute;top:20px;left:20px;background:#388e3c;padding:10px 18px;border-radius:12px;color:white;}
</style>
</head>
<body>
<div class="container">
  <button id="back-button">Kembali</button>
  <h1>Buat Update Baru</h1>
  <form id="updateForm">
    <label for="tajuk">Tajuk</label><input id="tajuk" required>
    <label for="isi">Isi</label><textarea id="isi" required></textarea>
    <label for="media">Upload Media (gambar/video, max 3)</label><input type="file" id="media" multiple accept="image/*,video/*">
    <label for="themeColor">Warna Tema</label><input type="color" id="themeColor" value="#1b5e20">
    <button type="submit">Hantar</button>
  </form>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-storage.js";

  const firebaseConfig = {
    apiKey: "AIzaSyD5kksl475n1Blo9tjP9KVMSrebO8AFJxc",
    authDomain: "latenight-4c61a.firebaseapp.com",
    projectId: "latenight-4c61a",
    storageBucket: "latenight-4c61a.firebasestorage.app",
    messagingSenderId: "208698993180",
    appId: "1:208698993180:web:7741767d129b4d43034dd9",
    measurementId: "G-MVKZ0R87Y3"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const storage = getStorage(app);

  document.getElementById("back-button").onclick=()=>window.location.href="index.html";

  document.getElementById("updateForm").addEventListener("submit", async(e)=>{
    e.preventDefault();
    const tajuk=document.getElementById("tajuk").value.trim();
    const isi=document.getElementById("isi").value.trim();
    const themeColor=document.getElementById("themeColor").value;
    const files=Array.from(document.getElementById("media").files).slice(0,3);

    const mediaUrls=[];
    for(const file of files){
      const fileRef=ref(storage,`updates/${Date.now()}-${file.name}`);
      await uploadBytes(fileRef,file);
      const url=await getDownloadURL(fileRef);
      mediaUrls.push({type:file.type.startsWith("video")?"video":"image",url});
    }

    await addDoc(collection(db,"updates"),{tajuk,isi,themeColor,media:mediaUrls,createdAt:serverTimestamp()});
    alert("Update berjaya disimpan!");
    window.location.href="index.html";
  });
</script>
</body>
</html>
